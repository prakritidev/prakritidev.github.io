<!DOCTYPE html>
<html lang="en"><head><title>A Personal Tale of Data Transformation - The Simple Genius of jq, GNU Parallel, and a Task Queue</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="A Personal Tale of Data Transformation - The Simple Genius of jq, GNU Parallel, and a Task Queue"/><meta property="og:description" content="As a lead backend engineer and an avid finance enthusiast, my journey has blended advanced programming with machine learning insights in the finance sector ..."/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="As a lead backend engineer and an avid finance enthusiast, my journey has blended advanced programming with machine learning insights in the finance sector ..."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Tech/A-Personal-Tale-of-Data-Transformation---The-Simple-Genius-of-jq,-GNU-Parallel,-and-a-Task-Queue"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">ü™¥ Quartz 4.0</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;AWS-Associate-Architect-Notes&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Low-Level-Desing&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Tech&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Understanding-Of-Life&quot;,&quot;collapsed&quot;:true}]"><h1>Explorer</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="AWS-Associate-Architect-Notes"><button class="folder-button"><span class="folder-title">AWS Associate Architect Notes</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="AWS-Associate-Architect-Notes"><li><a href="../AWS-Associate-Architect-Notes/2018-AWS-GuideLines" data-for="AWS-Associate-Architect-Notes/2018-AWS-GuideLines">&quot;2018 AWS GuideLines&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/Amazon-ElastiCache" data-for="AWS-Associate-Architect-Notes/Amazon-ElastiCache">&quot;Amazon ElastiCache&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/AWS---EC2-AND-EBS" data-for="AWS-Associate-Architect-Notes/AWS---EC2-AND-EBS">&quot;AWS - EC2 AND EBS&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/Database(RDS)-and-Redshift" data-for="AWS-Associate-Architect-Notes/Database(RDS)-and-Redshift">&quot;Database (RDS) and Redshift&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/DNS-and-Route53" data-for="AWS-Associate-Architect-Notes/DNS-and-Route53">&quot;DNS and Route53&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/Elastic-Load-Balancing,-Amazon-CloudWatch,-and-Auto-Scaling" data-for="AWS-Associate-Architect-Notes/Elastic-Load-Balancing,-Amazon-CloudWatch,-and-Auto-Scaling">&quot;Elastic Load Balancing, Amazon CloudWatch, and Auto Scaling&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/S3-and-Glacier" data-for="AWS-Associate-Architect-Notes/S3-and-Glacier">&quot;S3 and Glacier&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/Security-and-IAM" data-for="AWS-Associate-Architect-Notes/Security-and-IAM">&quot;Security and IAM&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/SQS,-SNS,-and-SWF" data-for="AWS-Associate-Architect-Notes/SQS,-SNS,-and-SWF">&quot;SQS, SNS, and SWF&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/VPC-(Virtual-Private-Cloud)" data-for="AWS-Associate-Architect-Notes/VPC-(Virtual-Private-Cloud)">&quot;VPC (Virtual Private Cloud)&quot;</a></li><li><a href="../AWS-Associate-Architect-Notes/Index" data-for="AWS-Associate-Architect-Notes/Index">Index</a></li></ul></div></li><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Low-Level-Desing"><button class="folder-button"><span class="folder-title">Low Level Desing</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Low-Level-Desing"><li><a href="../Low-Level-Desing/Interviers---LeetCode" data-for="Low-Level-Desing/Interviers---LeetCode">&quot;Interviers - LeetCode&quot;</a></li><li><a href="../Low-Level-Desing/Interviews---Hotel-Booking-(MMT)" data-for="Low-Level-Desing/Interviews---Hotel-Booking-(MMT)">&quot;Interviews - Hotel Booking (MMt)&quot;</a></li><li><a href="../Low-Level-Desing/Interviews---ParkingLot-low-Level-Design" data-for="Low-Level-Desing/Interviews---ParkingLot-low-Level-Design">&quot;Parking Lot low Level Design&quot;</a></li><li><a href="../Low-Level-Desing/Index" data-for="Low-Level-Desing/Index">Index</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Tech"><button class="folder-button"><span class="folder-title">Tech</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Tech"><li><a href="../Tech/A-Personal-Tale-of-Data-Transformation---The-Simple-Genius-of-jq,-GNU-Parallel,-and-a-Task-Queue" data-for="Tech/A-Personal-Tale-of-Data-Transformation---The-Simple-Genius-of-jq,-GNU-Parallel,-and-a-Task-Queue">&quot;A Personal Tale of Data Transformation - The Simple Genius of jq, GNU Parallel, and a Task Queue&quot;</a></li><li><a href="../Tech/Battle---NodeJs-vs-Spring-Webflux" data-for="Tech/Battle---NodeJs-vs-Spring-Webflux">&quot;Battle - NodeJs vs Spring Webflux&quot;</a></li><li><a href="../Tech/Bloom-Filter-Implementation-in-Java-" data-for="Tech/Bloom-Filter-Implementation-in-Java-">&quot;Bloom Filter Implementation in Java &quot;</a></li><li><a href="../Tech/Cloud-Design-Patterns" data-for="Tech/Cloud-Design-Patterns">&quot;Cloud Design Patterns&quot;</a></li><li><a href="../Tech/Efficient-Data-Processing-on-a-Budget---My-Journey-with-File-Based-Queues" data-for="Tech/Efficient-Data-Processing-on-a-Budget---My-Journey-with-File-Based-Queues">&quot;Efficient Data Processing on a Budget - My Journey with File-Based Queues&quot;</a></li><li><a href="../Tech/Git-Advanced" data-for="Tech/Git-Advanced">&quot;Git Advanced&quot;</a></li><li><a href="../Tech/GNU-Parallel---Alternative-to-Language-Programming" data-for="Tech/GNU-Parallel---Alternative-to-Language-Programming">&quot;GNU Parallel - Alternative to Language Programming&quot;</a></li><li><a href="../Tech/Git-Basics" data-for="Tech/Git-Basics">&quot;Introduction&quot;</a></li><li><a href="../Tech/Java---Count-Min-Sketch-" data-for="Tech/Java---Count-Min-Sketch-">&quot;Java - Count Min Sketch &quot;</a></li><li><a href="../Tech/Java---jdk-(open-source-getting-started)" data-for="Tech/Java---jdk-(open-source-getting-started)">&quot;Java - jdk (open source getting started)&quot;</a></li><li><a href="../Tech/Java---Multi-Threading-Why-" data-for="Tech/Java---Multi-Threading-Why-">&quot;Java - Multi Threading Why ?&quot;</a></li><li><a href="../Tech/Java-Streams-(Part-1)" data-for="Tech/Java-Streams-(Part-1)">&quot;Java - Streams&quot;</a></li><li><a href="../Tech/JQ-(Basics)---Json-Processing-on-terminal" data-for="Tech/JQ-(Basics)---Json-Processing-on-terminal">&quot;JQ (Basics) - Json Processing on terminal&quot;</a></li><li><a href="../Tech/MySQL-8-Write-Ahead-Async-Log-" data-for="Tech/MySQL-8-Write-Ahead-Async-Log-">&quot;MySQL 8 Write Ahead Async Log &quot;</a></li><li><a href="../Tech/Terminal---Warp-vs-iterm2" data-for="Tech/Terminal---Warp-vs-iterm2">&quot;Terminal - Warp vs iterm2&quot;</a></li><li><a href="../Tech/Transations---2-PC-and-3-PC-" data-for="Tech/Transations---2-PC-and-3-PC-">&quot;Transations - 2 PC and 3 PC &quot;</a></li><li><a href="../Tech/What-is-a-Socket-" data-for="Tech/What-is-a-Socket-">&quot;What is a Socket ?&quot;</a></li><li><a href="../Tech/What-is-gRPC-" data-for="Tech/What-is-gRPC-">&quot;What is gRPC? &quot;</a></li><li><a href="../Tech/What-is-IPC-" data-for="Tech/What-is-IPC-">&quot;What is IPC ?&quot;</a></li><li><a href="../Tech/Index" data-for="Tech/Index">Index</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Understanding-Of-Life"><button class="folder-button"><span class="folder-title">Understanding Of Life</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Understanding-Of-Life"><li><a href="../Understanding-Of-Life/How-to-earn-respect-in-front-of-parents--index" data-for="Understanding-Of-Life/How-to-earn-respect-in-front-of-parents--index">&quot;How to earn respect in front of parents ? &quot;</a></li><li><a href="../Understanding-Of-Life/What-is-the-essence-of-this-series" data-for="Understanding-Of-Life/What-is-the-essence-of-this-series">&quot;What is the essence of this series?&quot;</a></li><li><a href="../Understanding-Of-Life/Index" data-for="Understanding-Of-Life/Index">Index</a></li></ul></div></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href="../Tech/">Tech</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href>A Personal Tale of Data Transformation - The Simple Genius of jq, GNU Parallel, and a Task Queue</a></div></nav><h1 class="article-title">A Personal Tale of Data Transformation - The Simple Genius of jq, GNU Parallel, and a Task Queue</h1><p show-comma="true" class="content-meta"><span>Jun 14, 2024</span><span>6 min read</span></p><ul class="tags"><li><a href="../tags/GNU" class="internal tag-link">GNU</a></li><li><a href="../tags/parallel" class="internal tag-link">parallel</a></li><li><a href="../tags/jq" class="internal tag-link">jq</a></li><li><a href="../tags/queue" class="internal tag-link">queue</a></li><li><a href="../tags/collegedays" class="internal tag-link">collegedays</a></li><li><a href="../tags/goodtimes" class="internal tag-link">goodtimes</a></li></ul></div></div><article class="popover-hint"><p>As a lead backend engineer and an avid finance enthusiast, my journey has blended advanced programming with machine learning insights in the finance sector. Starting with Python, then moving to JavaScript and Go for their respective strengths, I eventually found that their capabilities were stretched by the demanding pace of my tasks. This led me to discover the efficiency of jq, GNU Parallel, and a file-based task queue. This powerful trio not only streamlined my stock market projects but also proved invaluable for parsing application logs and transforming data across various domains. Their impact was so profound that I‚Äôve since incorporated them into complex tasks like transferring millions of events swiftly using SQS. I‚Äôm excited to share how these tools have simplified my approach beyond traditional programming.</p>
<h2 id="what-is-jq"><strong>What is jq?</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#what-is-jq" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>jq is like a Swiss Army knife for JSON data. It‚Äôs a lightweight and flexible command-line JSON processor. You can slice, dice, transform, and reshape JSON data in whichever way you fancy. The best part? Its syntax is intuitive and powerful, perfect for quick one-liners or complex transformations.</p>
<p>Let‚Äôs take an example json that I build myself (chatGPT) for better understanding.</p>
<pre><code>{  
  &quot;products&quot;: [  
    {&quot;id&quot;: 1, &quot;name&quot;: &quot;Laptop&quot;, &quot;price&quot;: 800, &quot;inStock&quot;: true},  
    {&quot;id&quot;: 2, &quot;name&quot;: &quot;Smartphone&quot;, &quot;price&quot;: 500, &quot;inStock&quot;: false},  
    {&quot;id&quot;: 3, &quot;name&quot;: &quot;Tablet&quot;, &quot;price&quot;: 300, &quot;inStock&quot;: true},  
    {&quot;id&quot;: 4, &quot;name&quot;: &quot;Smartwatch&quot;, &quot;price&quot;: 200, &quot;inStock&quot;: true},  
    {&quot;id&quot;: 5, &quot;name&quot;: &quot;Camera&quot;, &quot;price&quot;: 150, &quot;inStock&quot;: false}  
  ]  
}
</code></pre>
<p><strong>Filtering by Price and Stock Availability</strong></p>
<ul>
<li>Task: Select products priced over $300 and currently in stock.</li>
<li>Command:¬†<code>jq '.products[] | select(.price > 300 and .inStock == true)' products.json</code></li>
<li>Output:¬†<code>{ &quot;id&quot;: 1, &quot;name&quot;: &quot;Laptop&quot;, &quot;price&quot;: 800, &quot;inStock&quot;: true }</code></li>
</ul>
<p><strong>Calculating Average Price</strong></p>
<ul>
<li>Task: Compute the average price of all products.</li>
<li>Command:¬†<code>jq '[.products[].price] | add / length' products.json</code></li>
<li>Output:¬†<code>390</code></li>
</ul>
<p><strong>Combining and Deduplicating Data from Multiple Files</strong></p>
<ul>
<li>Additional File (<code>additional_products.json</code>):¬†<code>[{&quot;id&quot;: 6, &quot;name&quot;: &quot;Headphones&quot;, &quot;price&quot;: 100, &quot;inStock&quot;: true}, {&quot;id&quot;: 1, &quot;name&quot;: &quot;Laptop&quot;, &quot;price&quot;: 800, &quot;inStock&quot;: true}]</code></li>
<li>Task: Merge product data from two files, removing duplicates.</li>
<li>Command:¬†<code>jq -s 'add | unique_by(.id)' products.json additional_products.json</code></li>
</ul>
<p>[<br/>
{‚Äúid‚Äù: 1, ‚Äúname‚Äù: ‚ÄúLaptop‚Äù, ‚Äúprice‚Äù: 800, ‚ÄúinStock‚Äù: true},<br/>
{‚Äúid‚Äù: 6, ‚Äúname‚Äù: ‚ÄúHeadphones‚Äù, ‚Äúprice‚Äù: 100, ‚ÄúinStock‚Äù: true}<br/>
]</p>
<p>Converting JSON to CSV Format</p>
<ul>
<li>Command:¬†<code>jq -r '.products[] | [.id, .name, .price] | @csv' products.json</code></li>
</ul>
<pre><code>1,&quot;Laptop&quot;,800  
2,&quot;Smartphone&quot;,500  
3,&quot;Camera&quot;,150
</code></pre>
<p>As you can see we can do the things that we used to to with pandas or javascript etc. Imagine doing this calculation on mongodb exported documents data to maybe on an elastisearch query response (Elasticsearch has REST endpoints unlike others).</p>
<p>Now comes the GNU Parallel.</p>
<h2 id="what-is-gnu-parallel"><strong>What is GNU Parallel?</strong><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#what-is-gnu-parallel" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>GNU Parallel is a tool for executing jobs in parallel, using one or more computers. It‚Äôs like a magic wand that takes a bunch of tasks and distributes them across available CPU cores, speeding up processing significantly. It‚Äôs particularly useful for repetitive tasks that can be run concurrently.</p>
<p><strong>Task</strong>: Run a complex command involving pipes and redirections.</p>
<p>Command:¬†<code>parallel &quot;grep -E '^[^2][0-9]{2} ' {} | wc -l > {}.count&quot; ::: access_log*.txt</code></p>
<p>UseCase: I heavily use this when searching things in logs, specifically when shit hits the floor # funtimes</p>
<p><strong>Task</strong>: You want to run a set number of jobs in parallel from a larger list of tasks.</p>
<p>command:¬†<code>cat urls.txt | parallel -j 10 curl -O</code></p>
<p>UseCase**:**¬†This will download files from a list of URLs in urls.txt, running 10 downloads in parallel at any time. (Torrents I guess<a href=".././tags/collegedays" class="tag-link internal alias" data-slug="tags/collegedays">collegedays</a>), I use it for data scrapping POC though # fuckMyLife.</p>
<p><strong>Task</strong>: Execute tasks in parallel but keep the output in the same order as input.</p>
<p>command:¬†<code>parallel ‚Äî keep-order echo ::: $(seq 1 5)</code></p>
<p>UseCase: because sometime you need order in your life.</p>
<p><strong>Task</strong>: Suppose you have a script process.sh that takes two arguments, and you want to run it for different combinations of arguments in parallel.</p>
<p>command: parallel ./process.sh ::: arg1 arg2 arg3 ::: argA argB</p>
<p>This command will execute ./process.sh with all combinations of the arguments, resulting in six executions:</p>
<pre><code>- ./process.sh arg1 argA
- ./process.sh arg1 argB
- ./process.sh arg2 argA
- ./process.sh arg2 argB
- ./process.sh arg3 argA
- ./process.sh arg3 argB
</code></pre>
<p>UseCase: I used this to test our system with different settings, revealing varying outcomes. We suspected the database might cache data, so we gave it a shot. Surprisingly, we ran ElasticSearch and Spring Boot on a modest 2 GB server, hitting an impressive average of 300+ requests per second on an EC2 instance with 30 concurrent requests. This convinced us to embrace Docker for ElasticsSearch and our apps, giving us more control over hardware and the power to maximize CPU usage.<a href=".././tags/goodtimes" class="tag-link internal alias" data-slug="tags/goodtimes">goodtimes</a>.</p>
<p><strong>How to Emulate File-Based Queue Logic for Resuming Processing?</strong></p>
<p>The brilliance of a file-based task queue lies in its simplicity and dependability. Here‚Äôs a quick guide on how to set it up:</p>
<ol>
<li>Create a Task File: This file lists all the tasks to be processed, one per line, like a to-do list.</li>
<li>Process with GNU Parallel: Run GNU Parallel, directing it to your task file. It picks up each task and executes it.</li>
<li>Logging Progress: GNU Parallel keeps a progress log. If the process halts, you can resume it, and Parallel will continue from where it stopped, skipping completed tasks.</li>
<li>Easy Resumption: This setup ensures that interruptions don‚Äôt require starting from scratch. Simply run the command, and it continues processing the remaining tasks.</li>
</ol>
<h1 id="create-a-tasks-file">Create a tasks file<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#create-a-tasks-file" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>echo &quot;task1\ntask2\ntask3&quot; > tasks.txt  
</code></pre>
<h1 id="process-with-gnu-parallel">Process with GNU Parallel<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#process-with-gnu-parallel" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>parallel --joblog progress.log &lt; tasks.txt
</code></pre>
<p>An example of web scraping using a combination of tools like jq, GNU Parallel, and a file-based queue and utilising the DummyJSON website (chatGPT). Keep in mind that you can also use these tools individually for different purposes.</p>
<pre><code>#!/bin/bash  
</code></pre>
<h1 id="create-a-task-file-with-urls">Create a task file with URLs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#create-a-task-file-with-urls" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>echo &quot;https://dummyjson.com/products/1&quot; > tasks.txt  
echo &quot;https://dummyjson.com/products/2&quot; >> tasks.txt  
echo &quot;https://dummyjson.com/products/3&quot; >> tasks.txt  
echo &quot;https://dummyjson.com/products/4&quot; >> tasks.txt  
echo &quot;https://dummyjson.com/products/5&quot; >> tasks.txt  
</code></pre>
<h1 id="create-a-queue-file-to-store-failed-tasks">Create a queue file to store failed tasks<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#create-a-queue-file-to-store-failed-tasks" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>touch queue.txt  
</code></pre>
<h1 id="create-a-csv-file-with-headers">Create a CSV file with headers<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#create-a-csv-file-with-headers" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>echo &quot;id,title,description,price,discountPercentage,rating,stock,brand,category&quot; > output.csv  
</code></pre>
<h1 id="function-to-process-a-task-and-append-to-csv">Function to process a task and append to CSV<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#function-to-process-a-task-and-append-to-csv" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>function process_task() {  
    local url=&quot;$1&quot;  
      
    # Download JSON response and convert to CSV  
    local csv_data  
    csv_data=$(curl -s &quot;$url&quot; | jq -r '.id, .title, .description, .price, .discountPercentage, .rating, .stock, .brand, .category' | tr '\n' ',')  
  
    # Check HTTP status code  
    local http_status  
    http_status=$(curl -s -o /dev/null -w &quot;%{http_code}&quot; &quot;$url&quot;)  
  
    if [ &quot;$http_status&quot; -eq 200 ]; then  
        # Append CSV data to output.csv  
        echo &quot;$csv_data&quot; >> output.csv  
        # Remove the processed task from tasks.txt  
        grep -v &quot;$url&quot; tasks.txt > tasks_tmp.txt  
        mv tasks_tmp.txt tasks.txt  
    else  
        echo &quot;Failed: $url (HTTP Status: $http_status)&quot;  
        # Append the failed task to the queue file for retry  
        echo &quot;$url&quot; >> queue.txt  
    fi  
}  
  
</code></pre>
<h1 id="export-the-function-so-it-can-be-used-with-parallel">Export the function so it can be used with parallel<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#export-the-function-so-it-can-be-used-with-parallel" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>export -f process_task  
</code></pre>
<h1 id="process-tasks-with-gnu-parallel">Process tasks with GNU Parallel<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#process-tasks-with-gnu-parallel" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>cat tasks.txt | parallel -j10 process_task  
</code></pre>
<h1 id="clean-up-json-files">Clean up JSON files<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#clean-up-json-files" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>rm -f *.json  
</code></pre>
<h1 id="verify-that-taskstxt-and-queuetxt-are-empty">Verify that tasks.txt and queue.txt are empty<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#verify-that-taskstxt-and-queuetxt-are-empty" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<pre><code>if [ ! -s tasks.txt ]; then  
    rm tasks.txt  
fi  
if [ ! -s queue.txt ]; then  
    rm queue.txt  
fi
echo &quot;Processing completed.&quot;
</code></pre>
<p>I‚Äôm pondering whether to write about how I turned a stock prediction challenge into a machine learning adventure or perhaps dive into the showdown between Java virtual threads and Spring WebFlux. Well, that‚Äôs the plan for now. Until then, jai ram ji ki.</p></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc" class><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-1"><a href="#what-is-jq" data-for="what-is-jq">What is jq?</a></li><li class="depth-1"><a href="#what-is-gnu-parallel" data-for="what-is-gnu-parallel">What is GNU Parallel?</a></li><li class="depth-0"><a href="#create-a-tasks-file" data-for="create-a-tasks-file">Create a tasks file</a></li><li class="depth-0"><a href="#process-with-gnu-parallel" data-for="process-with-gnu-parallel">Process with GNU Parallel</a></li><li class="depth-0"><a href="#create-a-task-file-with-urls" data-for="create-a-task-file-with-urls">Create a task file with URLs</a></li><li class="depth-0"><a href="#create-a-queue-file-to-store-failed-tasks" data-for="create-a-queue-file-to-store-failed-tasks">Create a queue file to store failed tasks</a></li><li class="depth-0"><a href="#create-a-csv-file-with-headers" data-for="create-a-csv-file-with-headers">Create a CSV file with headers</a></li><li class="depth-0"><a href="#function-to-process-a-task-and-append-to-csv" data-for="function-to-process-a-task-and-append-to-csv">Function to process a task and append to CSV</a></li><li class="depth-0"><a href="#export-the-function-so-it-can-be-used-with-parallel" data-for="export-the-function-so-it-can-be-used-with-parallel">Export the function so it can be used with parallel</a></li><li class="depth-0"><a href="#process-tasks-with-gnu-parallel" data-for="process-tasks-with-gnu-parallel">Process tasks with GNU Parallel</a></li><li class="depth-0"><a href="#clean-up-json-files" data-for="clean-up-json-files">Clean up JSON files</a></li><li class="depth-0"><a href="#verify-that-taskstxt-and-queuetxt-are-empty" data-for="verify-that-taskstxt-and-queuetxt-are-empty">Verify that tasks.txt and queue.txt are empty</a></li></ul></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.3</a> ¬© 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">
            const socket = new WebSocket('ws://localhost:3001')
            // reload(true) ensures resources like images and scripts are fetched again in firefox
            socket.addEventListener('message', () => document.location.reload(true))
          </script><script src="../postscript.js" type="module"></script></html>